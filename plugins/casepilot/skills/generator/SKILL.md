---
name: casepilot
description: 智能测试用例生成器。当用户需要为 Story/需求/缺陷生成测试用例、创建 Markdown 格式的 markmap 思维导图测试用例、根据技术方案设计测试场景、或者需要生成测试覆盖矩阵时使用。支持功能测试、边界测试、异常测试、兼容性测试、性能测试、安全测试等多种测试类型。
---

# CasePilot 智能测试用例生成器

智能测试用例生成 Skill，从需求文档自动生成 **混合结构 Markdown** 格式的测试用例（可用 markmap 渲染）。

## MCP 服务器依赖

**重要**：此 Skill 依赖以下 MCP 服务器，使用前请确保已配置：

| MCP 服务器 | 用途 | 必需 |
|-----------|------|------|
| `lark-prj-new` | 读取飞书项目单子（描述、验收标准） | 是（使用飞书项目单时） |
| `lark-mcp-remote` | 读取飞书云文档（技术设计文档） | 是（使用飞书文档时） |

**注意**：如果仅使用本地文件生成测试用例，无需配置 MCP 服务器。

### 检测 MCP 配置

在使用此 Skill 前，首先检测 MCP 是否已配置：

1. 尝试调用 `mcp__lark-prj-new__get_workitem_info`（回退 `mcp__lark-prj-remote__get_workitem_info`）
2. 如果返回 "MCP server not found" 或类似错误，说明未配置
3. 此时应引导用户配置 MCP 或运行 `/casepilot:check-mcp`

## 触发关键词

以下关键词会触发此 Skill：

- "生成测试用例"
- "Markdown 测试用例"
- "markmap 测试用例"
- "XMind 测试用例"
- "飞书项目单子测试"
- "为这个需求生成用例"
- "创建测试用例思维导图"
- 提供飞书项目 URL

## 7 步工作流概要

本 Skill 的完整执行流程定义在 `commands/generate.md` 中，以下为概要：

```
步骤1: 解析输入与获取需求
  → 解析输入类型（飞书项目单/云文档/本地文件）
  → 获取需求内容（MCP工具自动发现字段）
  → 读取技术设计文档（如存在）
  → 输出简短摘要

步骤2: 需求分析与测试策略
  → 需求分析（内部处理）
  → 操作流程梳理（内部处理）
  → 测试策略制定（内部处理）
  → 输出分析摘要 → 用户确认（唯一确认点）

步骤3: 用例设计与覆盖度验证
  → 按 TEMPLATE.md 规范设计用例
  → 边设计边验证覆盖度
  → 智能优化

步骤4: 生成 Markdown 文件
  → 7层混合结构（标题+无序列表）
  → 模块编号: ## {N}. {模块名}
  → 用例命名: 验证{功能}{场景}，≤35字符
  → 保存到 ~/Testcase/markmap/

步骤5: Review 审查
  → 检测 superpowers 插件
  → 调用 superpowers:code-reviewer 审查用例质量
  → 自动修复格式/覆盖问题

步骤6: 覆盖度报告
  → 验收标准覆盖表
  → 测试类型覆盖表

步骤7: 输出总结
  → 需求名称、用例统计、文件路径
  → 飞书导入指引（Markdown → XMind → 飞书项目）
```

## 输入类型

| 类型 | URL 特征 | MCP 工具 |
|------|----------|----------|
| 飞书项目单 | `project.feishu.cn` + `story/detail` | `lark-prj-new`（回退 `lark-prj-remote`） |
| 飞书云文档 | `.feishu.cn/docx/` 或 `.feishu.cn/wiki/` | `lark-mcp-remote` |
| 本地文件 | 其他路径 | Read 工具 |

## 用例格式规范

每条测试用例采用 **7 层混合结构**，格式详见 `TEMPLATE.md`：

```
# 文档标题
  └── ## {N}. 模块名
        └── ### 用例名称
              └── - 前置条件
                    └──   - 执行步骤
                          └──     - 预期结果
                                └──       - 优先级
```

## 优先级定义

| 优先级 | 说明 | 适用场景 |
|--------|------|----------|
| P0 | 核心功能，必须测试 | 主流程、验收标准相关、PRD UI核心功能 |
| P1 | 重要功能，应该测试 | 配置参数、异常处理、边界条件 |
| P2 | 次要功能，可选测试 | 辅助功能、稳定性测试、极端场景 |

## 输出路径

```
~/Testcase/markmap/{工作项名称}_测试用例_{时间戳}.md
```

## 示例

### 输入示例

```
帮我为这个飞书项目单子生成测试用例：
https://project.feishu.cn/uts5wn/story/detail/6596729761
```

### 处理流程

1. 解析得到 `project_key=uts5wn`, `work_item_id=6596729761`
2. 调用 MCP 获取单子信息和技术文档
3. 需求分析与测试策略（输出摘要，用户确认）
4. 用例设计与覆盖度验证
5. 生成 Markdown 文件
6. Review 审查
7. 输出覆盖度报告和总结
